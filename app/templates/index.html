<!-- app/templates/index.html -->
{% extends "layout.html" %}
{% block content %}
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">Total Items in Stock</h5>
                <p class="card-text fs-1 fw-bold">{{ total_items }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">Total Inventory Value</h5>
                <p class="card-text fs-1 fw-bold">${{ "%.2f"|format(total_value) }}</p>
            </div>
        </div>
    </div>
</div>

<!-- NEW: Download Button Section -->
<div class="d-grid gap-2 mb-4">
    <a href="{{ url_for('main.download_inventory') }}" class="btn btn-success">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
            <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
            <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
        </svg>
        Download Full Inventory Report (CSV)
    </a>
</div>

<div class="row">
    <div class="col-md-7">
        <div class="card">
            <div class="card-header"><h2>Products Expiring Soon (Next 7 Days)</h2></div>
            <div class="card-body">
                {% if expiring_summary %}
                <ul class="list-group list-group-flush">
                    {% for name, data in expiring_summary.items() %}
                    <li class="list-group-item d-flex justify-content-between align-items-start">
                        <div>
                            <div class="fw-bold">{{ data.count }}x {{ name }}</div>
                            <small class="text-muted">Location: {{ data.location }}</small>
                            {% if data.carbon > 0 %}
                            <div class="mt-1" style="color: #28a745;">
                                <small>Saving this batch prevents <strong>{{ "%.2f"|format(data.carbon) }} kg</strong> of CO2 waste.</small>
                            </div>
                            {% endif %}
                        </div>
                        <span class="badge bg-danger rounded-pill">Expires: {{ data.expiry.strftime('%b %d') }}</span>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p>No products are expiring in the next 7 days.</p>
                {% endif %}
            </div>
        </div>
    </div>
 <div class="col-md-5">
    <div class="card" style="height: 100%;">
        <div class="card-header"><h2>AI Assistant</h2></div>
        <div class="card-body d-flex flex-column">
            <!-- The chat window where messages will appear -->
            <div id="chat-window" class="flex-grow-1 border p-3 mb-3 rounded" style="overflow-y: scroll;">
                <!-- Initial message will be added by JavaScript -->
            </div>
            <!-- The input form -->
            <div class="input-group">
                <input type="text" id="chat-input" class="form-control" placeholder="Ask me anything...">
                <button id="send-btn" class="btn btn-primary">
                    <i class="bi bi-send-fill"></i> Send
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}```
